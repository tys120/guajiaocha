!function(e){"function"==typeof define&&define.dmmma?define(e):e()}(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){for(var n=0;t.length>n;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e){for(var t=1;arguments.length>t;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(o,!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(o).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function a(e){return function(e){if(Array.isArray(e))return e}(e)||c(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);e.length>t;t++)n[t]=e[t];return n}}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(){}function l(e,t,n){var i="function"==typeof t?t:s;if(e&&"success"===e.status)if(e.data)if(n)i(e.data);else try{i(JSON.parse(e.data))}catch(t){i({err:"解析失败",response:e.data})}else i({err:"容器返回空"});else i({err:"容器异常"})}module.exports=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t={spmAPos:"",spmBPos:"",callBridge:function(){var e;(e=my).call.apply(e,arguments)},bizType:"common",logLevel:2,chInfo:"",scm:"",url:"",mdata:{},ready:!1,debug:!1,apiCashList:[],trace:!1,isTraced:!1};if(!e.spmAPos&&!e.spmBPos)throw Error("实例化Tracert失败，SPM缺失");Object.assign(this,t,e),this.init()}var i,c,s;return i=n,(c=[{key:"getValueOfUrl",value:function(e,t){var n="";try{n=RegExp("(?=\\?|\\&|\\b|^)".concat(e,"\\=(.+?)(?=\\&|$)")).exec(t),n=decodeURIComponent(n=n?"".concat(n[1]):"")}catch(e){console&&console.warn("解析启动参数中的URL失败")}return n}},{key:"init",value:function(){var e=this,t=this.apiCashList,n=this.chInfo,i=this.getValueOfUrl;this.callBridge("getStartupParams",function(o){var c=o.chInfo||o.chinfo||i("chInfo",o.url)||i("chinfo",o.url)||"",s=o.scm||i("scm",o.url)||"",l=!(!o.trace&&!i("trace",o.url));e.set({chInfo:n||c,scm:s,trace:l,ready:!0});for(var f=0;t.length>f;f++){var h=a([].slice.call(t[f])),u=h[0],p=h.slice(1);e.call.apply(e,[u].concat(r(p)))}})}},{key:"get",value:function(e){return this[e]}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t;"object"===e(n.mdata)&&(n.mdata=o({},this.mdata,{},n.mdata)),Object.assign(this,t)}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.set(e),this.autoLogPv&&this.call("logPv")}},{key:"send",value:function(e,t){var n=this.debug,i=t.call(this);n&&console&&console.log(e,i),this.callBridge(e,i),"reportData"===e&&this.call("checkFullLinkParams")}},{key:"call",value:function(){var e,t=[].slice.call(arguments);if(this.ready){if(!this[t[0]]||"function"!=typeof this[t[0]])return console.warn("未找到方法：".concat(t[0])),null;var n=t.slice(1);e=this[t[0]].apply(this,n)}else this.apiCashList.push(t);return e}},{key:"logPv",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.call("send","reportData",function(){var n=e.spmBPos,i=e.mdata,a=e.chInfo;return{spm:{url:e.url,bizType:e.bizType,isSPM:!0,spmId:"".concat(e.spmAPos,".").concat(n)},spmDetail:o({chInfo:a},i,{},t)}})}},{key:"_fillspm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(".");return t.length>2?e:"".concat(this.spmAPos,".").concat(this.spmBPos,".").concat(e)}},{key:"click",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;this.call("send","remoteLog",function(){var r={type:"monitor",bizType:n.bizType,logLevel:n.logLevel,param1:n.url,param4:o({chInfo:n.chInfo},n.mdata,{},i),actionId:"clicked",spmId:n._fillspm(t)};return a&&"object"===e(a)&&a.param5&&(r.param5=a.param5),r})}},{key:"expo",value:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;this.call("send","remoteLog",function(){var r={type:"monitor",bizType:n.bizType,logLevel:n.logLevel,param1:n.url,param4:o({chInfo:n.chInfo},n.mdata,{},i),actionId:"exposure",spmId:n._fillspm(t)};return a&&"object"===e(a)&&a.param5&&(r.param5=a.param5),r})}},{key:"checkFullLinkParams",value:function(){var e=this;this.trace&&!this.isTraced&&this.callBridge("handleLoggingAction",{actionType:"setPageParams",data:JSON.stringify({chinfo:this.chInfo,scm:this.scm})},function(){e.set({isTraced:!0})})}},{key:"expoContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.expo(e,i,{param5:"newChinfo=".concat(n,"^scm=").concat(t)})}},{key:"clickContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.click(e,i,{param5:"newChinfo=".concat(n,"^scm=").concat(t)})}},{key:"setPageParams",value:function(e,t){this._setParams("setPageParams",e,t)}},{key:"setNextPageParams",value:function(e){this._setParams("setNextPageParams",e)}},{key:"appendChinfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setChinfoChain("appendChinfo",e)}},{key:"updateChinfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setChinfoChain("updateChinfo",e)}},{key:"getChinfoChain",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="getChinfoChain",a={};"boolean"==typeof n&&n&&(a.isFiltered="1"),"object"===e(n)&&(n.isFirst?i="getFirstChinfo":n.isFiltered&&(a.isFiltered="1")),this.callBridge("handleLoggingAction",o({actionType:i},a),function(e){l(e,t)})}},{key:"getChinfoChainUUID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={actionType:"getChinfoChainUUID"};t.isFiltered&&(n.isFiltered="1"),t.bizName&&(n.bizName=t.bizName),this.callBridge("handleLoggingAction",n,function(t){l(t,e,!0)})}},{key:"getCurrentPageParams",value:function(e){this.callBridge("handleLoggingAction",{actionType:"getCurrentPageParams"},function(t){l(t,e)})}},{key:"setCurrentPageNewChinfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setNewChinfo("setCurrentPageNewChinfo",e)}},{key:"setNextPageNewChinfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setNewChinfo("setNextPageNewChinfo",e)}},{key:"_setParams",value:function(t,n,i){if(n){var a={},r={};if("string"==typeof n&&(a.chinfo=n||"",a.scm=i||""),"object"===e(n)){var c=n.newChinfo,s=void 0===c?"":c,l=n.chinfo,f=void 0===l?"":l,h=n.entityId,u=void 0===h?"":h,p=n.scm,g=void 0===p?"":p,v=n.tracestep,d=void 0===v?3:v,y=n.isforce;s&&(a.newChinfo=s),f&&(a.chinfo=f),a.scm=u||g||"",r.tracestep=d,y&&(r.isforce="1")}this.callBridge("handleLoggingAction",o({actionType:t,data:JSON.stringify(a)},r))}}},{key:"_setChinfoChain",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},i=t.newChinfo||"",o=t.chInfo||t.chinfo||"",a=t.entityId||t.scm||"";i&&(n.newChinfo=i),o&&(n.chinfo=o),a&&(n.scm=a),this.callBridge("handleLoggingAction",{actionType:e,data:JSON.stringify(n),type:t.type||"click"})}},{key:"_setNewChinfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},i=t.newChinfo,o=void 0===i?"":i,a=t.scm,r=void 0===a?"":a;o&&(n.newChinfo=o,r&&(n.scm=r),this.callBridge("handleLoggingAction",{actionType:e,params:n}))}}])&&t(i.prototype,c),s&&t(i,s),n}()});
